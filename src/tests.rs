#[cfg(test)]
mod build;
#[cfg(test)]
mod jsify;

use crate::code::Code;
use crate::option::CompilerOptions;
use crate::{Compiler, Output, OutputFile};

use karinc::{hir::id::*, input::*};
use maplit::hashmap;

#[test]
fn compiles() {
    let input = InputTree {
        hakos: vec![
            InputHako {
                id: HakoId::new(0),
                name: "my_hako".to_string(),
                mods: vec![
                    InputMod {
                        id: ModId::new(0, 0),
                        path: "my_hako::main".into(),
                        source: "fn main(){}fn f(a bool,b bool){}".to_string(),
                        submods: Vec::new(),
                    },
                ],
            },
        ],
        main_hako_name: "my_hako".to_string(),
    };
    let options = CompilerOptions {
        output_root_name: "index".to_string(),
    };
    let output = Compiler::compile(&input, &options);
    assert_eq!(
        output,
        Output {
            file: OutputFile {
                name: "index".to_string(),
                ext: "js".to_string(),
                source: Some(
                    Code {
                        source: "/* This source code was automatically generated by karin compiler. */g$my_hako$main$main();function g$my_hako$main$main(){}function g$my_hako$main$f(a$0,a$1){}".to_string(),
                    },
                ),
            },
            logs: hashmap! {
                ModId::new(0, 0) => Vec::new(),
            },
        },
    );
}
